"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[19297],{885617:(e,t,s)=>{var r;s.d(t,{MP:()=>r,C9:()=>n}),function(e){e.default="default",e.skypeConCore="conCore",e.mediaAgent="mediaAgent",e.CDL="CDL",e.copilot="copilot"}(r||(r={}));Object.entries(r).map((([e,t])=>({label:e,value:t})));const n=new Set(["AppInfo.ClientType","Window.Type","Panel.Context","Session.TelemetryWorkerType","AppInfo.ExpIds","UserInfo.ETag","UserInfo.HostETag","UserInfo.CountryCode","Window.Type","AppInfo.Version","AppInfo.ExperienceName"])},473319:(e,t,s)=>{s.d(t,{M:()=>k});var r,n=s(185252),i=s(337643),a=s(79798),o=s(335503),l=s(869978),h=s(279027),g=s(807733),d=s(600986),c=s(987932),u=s.n(c);class p extends d.E{constructor(e){super(),this.identifier="Teams_Email",this.trustedDomains=new Set(this.extractEmailTrustedDomains(e))}shouldScan(e){return p.AT_SYMBOLS_SHOULD_SCAN_REGEX.test(e)}scan(e){let t;p.EMAIL_MATCHER_REGEX.lastIndex=0,p.AT_SYMBOL_SCAN_REGEX.lastIndex=0;try{t=decodeURIComponent(e)}catch(s){t=e}const s=t.replace(p.AT_SYMBOL_SCAN_REGEX,"@");let r;for(;null!==(r=p.EMAIL_MATCHER_REGEX.exec(s));){const e=r[0],t=e.indexOf("@"),s=e.substring(t+1).toLowerCase();if(p.UUID_PATTERN_REGEX.test(e))continue;let n=!1;for(const e of this.trustedDomains)if(s.includes(e)){n=!0;break}if(!n&&u()(e,{allow_underscores:!0}))return!0}return!1}extractEmailTrustedDomains(e){const t=Object.entries(e?.scannerOptions||{}).find((([e])=>"Email"===e))?.[1],s=Object.entries(t||{}).find((([e])=>"trustedDomains"===e))?.[1];return Array.isArray(s)?s:[]}}p.AT_SYMBOLS_SHOULD_SCAN_REGEX=new RegExp("@|_at_|%40","i"),p.AT_SYMBOL_SCAN_REGEX=new RegExp("_at_","gi"),p.EMAIL_MATCHER_REGEX=new RegExp("[A-Za-z0-9_%\\-\\+#]+(?:\\.[A-Za-z0-9_%\\-\\+#]+)*@[A-Za-z0-9](?:[A-Za-z0-9\\-]{0,61}[A-Za-z0-9])?(?:\\.[A-Za-z0-9](?:[A-Za-z0-9\\-]{0,61}[A-Za-z0-9])?)*\\.[A-Za-z](?:[A-Za-z0-9\\-]{0,61}[A-Za-z])?","gim"),p.UUID_PATTERN_REGEX=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}","i");class _ extends d.E{constructor(e){super(),this.identifier="Teams_FileName",this.fileNameScannerOptions=this.extractFileNameScannerOptions(e)}shouldScan(e){return!this.fileNameScannerOptions.messagePatternsToIgnoreRegex?.test(e)&&_.FILE_EXTENSION_REGEX.test(e)}scan(e){let t;_.COMMON_DELIMITERS_REGEX.lastIndex=0;try{t=decodeURIComponent(e)}catch(s){t=e}const s=t.split(_.COMMON_DELIMITERS_REGEX);for(const e of s)if(this.isValidFileName(e))return!0;return!1}isValidFileName(e){return e.trim().length>_.MIN_FILENAME_LENGTH&&e.trim().length<_.MAX_FILENAME_LENGTH&&e.includes(".")&&!_.UUID_PATTERN_REGEX.test(e)&&!this.fileNameScannerOptions.fileNamePatternsToIgnoreRegex?.test(e)&&_.FILE_NAME_VALIDATOR_REGEX.test(e)}extractFileNameScannerOptions(e){const t=Object.entries(e?.scannerOptions||{}).find((([e])=>"Teams_FileName"===e))?.[1],s=Object.entries(t||[]).find((([e])=>"fileNamePatternsToIgnore"===e))?.[1],r=Object.entries(t||[]).find((([e])=>"messagePatternsToIgnore"===e))?.[1];return{fileNamePatternsToIgnoreRegex:Array.isArray(s)?this.createRegexFromPatterns(s):void 0,messagePatternsToIgnoreRegex:Array.isArray(r)?this.createRegexFromPatterns(r):void 0}}createRegexFromPatterns(e){if(e&&0!==e.length)return new RegExp(`(${e.map((e=>`(?:${e})`)).join("|")})`,"i")}}_.MIN_FILENAME_LENGTH=4,_.MAX_FILENAME_LENGTH=255,_.FileExtensions=new Set(["pdf","docx","doc","xlsx","xls","pptx","ppt","txt","rtf","odt","csv","jpeg","jpg","png","gif","svg","mp4","avi","mov","wmv","mkv","zip","rar","7z","tar","gz"]),_.EXTENSION_PATTERN=`\\.(${Array.from(_.FileExtensions).join("|")})\\b`,_.FILE_EXTENSION_REGEX=new RegExp(_.EXTENSION_PATTERN,"i"),_.FILE_NAME_VALIDATOR_REGEX=new RegExp(`^(?!\\d+\\.\\d+[A-Z]+$)[^<>:"/\\|?*]+${_.EXTENSION_PATTERN}$`,"i"),_.COMMON_DELIMITERS_PATTERN=/[\s,;:"'<>()[\]{}|?=&/\\]/,_.COMMON_DELIMITERS_REGEX=new RegExp(_.COMMON_DELIMITERS_PATTERN,"g"),_.UUID_PATTERN_REGEX=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}","i"),function(e){e.TeamsEmail="Teams_Email",e.TeamsFileName="Teams_FileName"}(r||(r={}));class m{constructor(){this.logSanitizerPluginInstanceMap={},this.teamsScannerIds={}}createLogSanitizerPluginInstance(e,t){if(!this.logSanitizerPluginInstanceMap[e]){const s=new l.R;s.setEnabled(t),this.logSanitizerPluginInstanceMap[e]=s}return this.logSanitizerPluginInstanceMap[e]}updateLogSanitizerPluginConfigInstances(e,t){const s=this.toISanitizerConfig(t,!0);Object.values(this.logSanitizerPluginInstanceMap).forEach((t=>{t.setEnabled(!1),t.updateSanitizer(s),t.setEnabled(e)}))}toISanitizerConfig(e,t){(t||0===Object.keys(this.teamsScannerIds).length)&&this.initializeTeamsScanners(e);const s=[],r=[],n=(0,h.Q)();for(const t of e?.sanitize||[])t in g.B&&r.push(g.B[t]),t in this.teamsScannerIds&&r.push(this.teamsScannerIds[t]);for(const t of e?.warn||[])t in g.B&&s.push(g.B[t]),t in this.teamsScannerIds&&s.push(this.teamsScannerIds[t]);return{...n,...e,warn:s,sanitize:r}}initializeTeamsScanners(e){this.teamsScannerIds={[r.TeamsEmail]:()=>new p(e),[r.TeamsFileName]:()=>new _(e)}}}const f={maxStorageSizeInBytes:5e6,storageKeyPrefix:"Teams:telemetry-instrumentation-offline-storage",minPersistenceLevel:2,eventsLimitInMem:null,inMemoMaxTime:15e3,inStorageMaxTime:1008e4,maxRetry:1,maxBatchsize:63e3,maxSentBatchInterval:15e3};var v,T;!function(e){e[e.ONLINE=1]="ONLINE",e[e.OFFLINE=2]="OFFLINE"}(v||(v={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(T||(T={}));const I=["admin","Admin","ADMIN","administrator","Administrator","ADMINISTRATOR","automation","Automation","AUTOMATION","client","Client","CLIENT","limited","Limited","LIMITED","office","Office","OFFICE","services","Services","SERVICES","user","User","USER"],E={browserVer:"DeviceInfo.BrowserVersion",browserName:"DeviceInfo.BrowserName"},y="EventInfo.TraceId",S="EventInfo.SpanId",C="EventInfo.ParentSpanId",M="Scenario.Status",R="delta";class A{constructor(e){this.contextManager=e,this.oneDsLoggers={},this.secondPartyLoggers={},this.oneDsManager=new n.D,this.offlineChannel=new a.f,this.sharedConfig={},this.logSanitizerPluginManager=new m,this.privacyGuardMap={},this.privacyGuardCommonContext={},this.isOnline=!0,this.offlineMinPersistenceLevel=f.minPersistenceLevel,this.statusParams={active:!0,firstPartyLoggerTokens:{},secondPartyLoggerTokens:{}}}initialize(e){this.initParams=e,this.sharedConfig={instrumentationKey:e.appTokens.default,endpointUrl:e.oneDsCollectorUrl,propertyConfiguration:{populateBrowserInfo:!0,populateOperatingSystemInfo:!0,sessionAsGuid:!0},channelConfiguration:{payloadPreprocessor:e.enableCompression?(e,t)=>{this.gzipPayload(e,t)}:void 0,eventsLimitInMem:e.eventsLimitInMem,autoFlushEventsLimit:e.eventsLimitInMem*e.autoFlushPercent,ignoreMc1Ms0CookieProcessing:!0,enableCompoundKey:!0},maxMessageLimit:0},this.sharedConfig.extensionConfig||(this.sharedConfig.extensionConfig=[]),this.sharedConfig.extensionConfig[this.offlineChannel.identifier]={providers:[3],...f,...this.initParams.applicationInsightsOfflineSettings},this.offlineMinPersistenceLevel=this.initParams.applicationInsightsOfflineSettings?.minPersistenceLevel||this.offlineMinPersistenceLevel,this.oneDsManager.create(this.sharedConfig),this.oneDsManager.getPostChannel().core.stopPollingInternalLogs?.(),this.oneDsManager.addSharedPlugin(this.offlineChannel),this.updateSDKWithOfflineTelemetry(!!this.initParams.enableOfflineTelemetry),this.initParams.enablePrivacyGuard&&this._initializePrivacyGuard(),this.contextManager.contextCallbacks["DeviceInfo.OsVersion"]=this.onOsVersion.bind(this)}updateSDKWithPrivacyGuard(e){e?this._initializePrivacyGuard():this._stopPrivacyGuard()}updateSDKWithLogSanitizer(e,t){this.logSanitizerPluginManager.updateLogSanitizerPluginConfigInstances(e,t)}updateSDKWithOfflineTelemetry(e){this.oneDsManager.getPostChannel().core.getPlugin(this.offlineChannel.identifier).setEnabled(e)}setPrivacyGuardSensitiveInformation(e){const t=e.userNames,s=e.upns;if(t){const e=new Set(this.privacyGuardCommonContext.UserNames||[]);t.filter((e=>e)).forEach((t=>{e.add(t)})),this.privacyGuardCommonContext.UserNames=Array.from(e)}if(s){const e=new Set(this.privacyGuardCommonContext.UserAliases||[]);s.filter((e=>e)).forEach((t=>{const s=t.split("@")[0];s&&e.add(s)})),this.privacyGuardCommonContext.UserAliases=Array.from(e)}Object.keys(this.privacyGuardMap).forEach((e=>{const t=this.privacyGuardMap[e];t&&t.updateCommonContext(this.privacyGuardCommonContext)}))}start(){this.resume()}stop(){this.pause()}setOnlineState(e){this.offlineChannel.getOfflineListener().setOnlineState(e?v.ONLINE:v.OFFLINE),this.isOnline=e}pause(){this.oneDsManager.getPostChannel().pause(),this.statusParams.active=!1,this.traceIdTimer&&clearInterval(this.traceIdTimer)}resume(){this.oneDsManager.getPostChannel().resume(),this.statusParams.active=!0}setDeviceAuthToken(e){this.initParams?.enableLoggingGlobalDeviceId&&this.oneDsManager.getPostChannel().setMsaAuthTicket(e)}flush(e,t){this.oneDsManager.getPostChannel().flush(!!t,(()=>{e.postMessage("flushed")}))}flushForReinit(e){this.oneDsManager.getPostChannel().flush(!1,(()=>{e.postMessage("flushedForReinit"),this.pause()}))}createNewLogger(e,t){if(e&&(this.statusParams.firstPartyLoggerTokens[e]=""),e&&t&&this.initParams){const s=this.logSanitizerPluginManager.createLogSanitizerPluginInstance(t,this.initParams.enableLogSanitizer??!1),r=this.setupPrivacyGuard(t),n={extensionConfig:{[s.identifier]:this.logSanitizerPluginManager.toISanitizerConfig(this.initParams.logSanitizerConfig),[r.identifier]:{useEventFieldPrefix:!0,useAbsoluteFieldName:!0}}},i=this.oneDsManager.newInst(t,n,[s,r]);if(!i)return;i.stopPollingInternalLogs(),this.oneDsLoggers[e]=i,this.statusParams.firstPartyLoggerTokens[e]=t;const a="MSTeamsFix15SecondsProfile";this.oneDsManager.getPostChannel()._loadTransmitProfiles({[a]:[this.initParams.normalPrioritySendTimeInSecs,this.initParams.highPrioritySendTimeInSecs]}),this.oneDsManager.getPostChannel()._setTransmitProfile(a),this._handleSDKContextOverridesAtInit(i)}}logEvent(e,t,s){if(!e||!t)return;const r=this.oneDsLoggers[e];if(!r)return;const n=t.properties,i={logger:{value:e}};for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const t=n[e],s={value:t.value,kind:t.pii};i[e]=s}const a=new Date(t.timestamp).toISOString(),o={name:t.name,baseType:t.eventType,time:a,data:{...i,...this.contextManager.getContext(e,s)}},l=this.initParams?.eventPersistence?.[t.name];let h=1;if(void 0!==l?.[t.eventType]?h=l[t.eventType]:void 0!==l?.["*"]&&(h=l["*"]),o.persistence=h,!this.isOnline&&o.data&&o.persistence>=this.offlineMinPersistenceLevel&&(o.data["EventInfo.CapturedOffline"]={value:"true"}),this.initParams?.enableDistributedTracing&&this.initParams?.distributedTracingAllowList?.includes(t.eventType)&&o.data){o.ext={...o.ext,dt:{traceId:o.data?.[y]?.value,spanId:o.data?.[S]?.value}};const e=o.data?.[R]?.value||0,s=new Date(new Date(a).getTime()-e);o.baseData={...o.baseData,name:{value:t.eventType},kind:{value:T.CLIENT},time:{value:s.toISOString()},parentId:o.data?.[C]?.value,success:"success"===o.data?.[M]?.value?{value:!0}:{value:!1}},this.createSpansFromSteps(r,o,s)}r.track(o)}createNewSecondPartyLogger(e,t,s=!1){const r=this.logSanitizerPluginManager.createLogSanitizerPluginInstance(t,this.initParams?.enableLogSanitizer??!1),n=this.setupPrivacyGuard(t),i={extensionConfig:{[r.identifier]:this.logSanitizerPluginManager.toISanitizerConfig(this.initParams?.logSanitizerConfig),[n.identifier]:{useEventFieldPrefix:!0,useAbsoluteFieldName:!0}}},a=this.oneDsManager.newInst(t,i,[r,n]);a.stopPollingInternalLogs(),this.secondPartyLoggers[e]={logger:a,useTeamsContext:s},this.statusParams.secondPartyLoggerTokens[e]=t}logSecondPartyEvent(e,t){if(!e||!t)return;const s=this.secondPartyLoggers[e];s&&(s.useTeamsContext&&(t.data={...t.data,...this.contextManager.commonSchemaContextMap}),s.logger.track(t))}logSession(e,t){t.sessionId&&this.oneDsManager.getPropertyManager().getPropertiesContext().session.setId(t.sessionId)}gzipPayload(e,t){e.data=(0,o.gzip)(e.data),e.urlString+="&content-encoding=gzip",t(e)}handleSDKContextOverrides(e,t,s){if(!this.initParams?.enableSDKContextOverrides)return;if(!Object.values(E).includes(e))return;const r=s?[s]:Object.values(this.oneDsLoggers),n=t||this.contextManager.getContext(void 0)[e]?.value.toString();if(n)switch(e){case E.browserVer:r.forEach((e=>e.getOverridePropertyManager().getOverrideContext().web.setBrowserVer(n)));break;case E.browserName:r.forEach((e=>e.getOverridePropertyManager().getOverrideContext().web.setBrowser(n)))}}setupPrivacyGuard(e){if(!this.privacyGuardMap[e]){const t=new i.j;t.updateCommonContext({IgnoredNameParts:I,...this.privacyGuardCommonContext}),this.privacyGuardMap[e]=t}return this.initParams?.enablePrivacyGuard&&this.privacyGuardMap[e].setEnabled(!0),this.privacyGuardMap[e]}_handleSDKContextOverridesAtInit(e){Object.values(E).forEach((t=>this.handleSDKContextOverrides(t,this.contextManager.getContext(void 0)[t]?.value,e)))}_initializePrivacyGuard(){this.intervalId||(this.intervalId=setInterval((()=>{Object.keys(this.privacyGuardMap).forEach((e=>{this.privacyGuardMap[e].sendSummaryEvent(!0)}))}),6e5))}_stopPrivacyGuard(){this.intervalId&&clearInterval(this.intervalId),Object.keys(this.privacyGuardMap).forEach((e=>{this.privacyGuardMap[e].setEnabled(!1)}))}onOsVersion(e,t){this.oneDsManager.getPropertyManager().getPropertiesContext().os.ver=t}createSpansFromSteps(e,t,s){const r=t.data?.["Scenario.Steps"];if(r&&r.value){let n;const i=JSON.parse(r.value);if(1===i.length)return;i.forEach((r=>{const i=JSON.parse(JSON.stringify(t)),a=`${t.baseType}_${r["Scenario.Step"]}`;let o=s,l=r.delta;n&&(o=new Date(new Date(o).getTime()+n.delta),l=r.delta-n.delta),i.baseType=a,i.data={...i.data,"Scenario.Name":{value:a},delta:{value:l},elapsed:{value:r.elapsed}},i.baseData={...i.baseData,name:{value:a},time:{value:o.toISOString()},parentId:t?.ext?.dt.spanId},i.ext={...i.ext,dt:{...i.ext?.dt,spanId:this.generateSpanId()}},delete i?.data?.["Scenario.Steps"],n=r,e.track(i)}))}}generateSpanId(){const e=new Uint8Array(8);return void 0!==globalThis.crypto&&globalThis.crypto.getRandomValues(e),Array.from(e).map((e=>e.toString(16).padStart(2,"0"))).join("")}}var b=s(999974),x=s(885617);const P={"appinfo.id":"ext.app.id","appinfo.env":"ext.app.env","appinfo.version":"ext.app.ver","appinfo.versionnew":"ext.app.ver","appinfo.language":"ext.app.locale","userinfo.language":"ext.user.locale","userinfo.timezone":"ext.location.tz","userinfo.id":"ext.user.id","userinfo.tenantid":"ext.user.tenantid","deviceinfo.id":"ext.device.localid","deviceinfo.make":"ext.device.make","deviceinfo.model":"ext.device.model","deviceinfo.networktype":"ext.net.type","deviceinfo.browsername":"ext.web.browser","deviceinfo.browserversion":"ext.web.browserversion"},O="UserInfo.Id",D="AppInfo.ExpIds";class L{constructor(){this.contextMap={},this.userContextMap={},this.loggerContextMap={},this.enableMTMA=!1,this.enableMergedExpIds=!1,this.contextCallbacks={},this.commonSchemaContextMap={},this.primaryUser=""}setEnableMTMA(e){this.enableMTMA=e}setEnableMergedExpIds(e){this.enableMergedExpIds=e}setUserId(e){const t={value:e,kind:void 0};this.enableMTMA?this.setContext({key:O,value:e,userContextId:e},void 0):(this.contextMap[O]=t,this._setToCommonSchemaPropMap(O,t))}setPrimaryUser(e){this.primaryUser||(this.primaryUser=e,this.userContextMap[e]||(this.userContextMap[e]={}))}logOutUser(e){this.enableMTMA&&(this.userContextMap[e]={})}setContext(e,t){const s={value:e.value};this.enableMTMA?(e.userContextId?(this.userContextMap[e.userContextId]||(this.userContextMap[e.userContextId]={}),this.userContextMap[e.userContextId][e.key]=s):this.contextMap[e.key]=s,this._setToCommonSchemaPropMap(e.key,s)):(this.contextMap[e.key]=s,this._setToCommonSchemaPropMap(e.key,s)),e.key in this.contextCallbacks&&this.contextCallbacks[e.key](e.key,e.value),t?.handleSDKContextOverrides(e.key,e.value)}getContext(e,t){return t=t&&t.length>0?t:this.primaryUser,{...this._getMainContext(t),...this._getLoggerContext(e,t)}}setLoggerContext(e,t){if(e.logger&&(this.loggerContextMap[e.logger]||(this.loggerContextMap[e.logger]={baseMap:{},userMap:{}}),t.has(e.key))){const t={value:e.value};e.key===D&&this.enableMergedExpIds&&(t.value=this._joinExpIds(this.contextMap[D]?.value,e.value)),this.enableMTMA&&e.userContextId?(this.loggerContextMap[e.logger].userMap[e.userContextId]||(this.loggerContextMap[e.logger].userMap[e.userContextId]={}),this.loggerContextMap[e.logger].userMap[e.userContextId][e.key]=t):this.loggerContextMap[e.logger].baseMap[e.key]=t,e.key in this.contextCallbacks&&this.contextCallbacks[e.key](e.key,e.value)}}_getLoggerContext(e,t){return e?(this.loggerContextMap[e]||(this.loggerContextMap[e]={baseMap:{},userMap:{}}),{...this.loggerContextMap[e].baseMap,...t&&t.length&&this.enableMTMA?this.loggerContextMap[e].userMap[t]:{}}):{}}_getMainContext(e){return{...this.contextMap,...e&&e.length&&this.enableMTMA?this.userContextMap[e]:{}}}_joinExpIds(e,t){return e||t?!e&&t?t:e&&!t?e:Array.from(new Set([...e.split(","),...t.split(",")])).join(","):""}_setToCommonSchemaPropMap(e,t){const s=P[e.toLowerCase()];s&&(this.commonSchemaContextMap[s]=t)}}class k{constructor(){this.enableOneDsSdk=!1,this.existingTransports={},this.secondPartyLoggers={},this.firstPartyLoggers={},this.delayedTransportCallbacks=[],this.contextManager=new L,this.liteExperienceChannels={},this.performanceObserverCallback=e=>{this.router?.postMessage("onPerformanceObserverEntries",JSON.stringify(e.getEntries()))}}initialize(e){if(!e)throw new Error("WebWorkerRouter did not exist.");this.router=e,this._registerMessageHandlers(e)}setupFirstPartyRouter(e,t){e.registerMessageHandler("initialize",(t=>{this.telemetryTransport?e.postMessage("workerInitialized"):this.delayedTransportCallbacks.push((()=>e.postMessage("workerInitialized")))})),e.registerMessageHandler("newLogger",(e=>{this.telemetryTransport?.createNewLogger(e.key,e.value),this.firstPartyLoggers[e.key]=e.value})),e.registerMessageHandler("logEvent",(e=>{this.telemetryTransport?.logEvent(e.key,e.value,e.userContextId)})),e.registerMessageHandler("setContext",(e=>{const{contextFilter:s}=t;this.contextManager.setLoggerContext(e,s)}))}Verbose(e){this.router&&this.router.postMessage("verbose",e)}Error(e){this.router&&this.router.postMessage("error",e)}Info(e){this.router&&this.router.postMessage("info",e)}channelPortMessageHandlers(e,t,s,r){switch(e){case"initialize":this.telemetryTransport?t.postMessage({name:"workerInitialized",params:void 0}):this.delayedTransportCallbacks.push((()=>t.postMessage({name:"workerInitialized",params:void 0})));break;case"batch":for(const e of r)e&&e.name&&this.channelPortMessageHandlers(e.name,t,s,e?.params);t.postMessage({name:"batchDone",params:void 0});break;case"logEvent":if(r){const e=r;this.telemetryTransport?.logEvent(s??e.key,e.value,e.userContextId)}break;case"setContext":r&&(r.logger=s,this.contextManager.setLoggerContext(r,x.C9));break;case"newLogger":if(r){const e=r;this.telemetryTransport?.createNewLogger(e.key,e.value),this.firstPartyLoggers[e.key]=e.value}}}registerMessageChannelPort(e,t){e.onmessage=(t=>{this.channelPortMessageHandlers(t.data.operation,e,t.data.channel,t.data.params)}).bind(this),this.liteExperienceChannels[t]=e}_registerMessageHandlers(e){e.registerMessageHandler("initialize",(t=>{this.initTelemetryTransport(t),e.postMessage("workerInitialized")})),e.registerMessageHandler("start",(()=>{this.telemetryTransport?.start()})),e.registerMessageHandler("stop",(()=>{this.telemetryTransport?.stop()})),e.registerMessageHandler("flush",(t=>{this.telemetryTransport?.flush(e,t?.isAsync)})),e.registerMessageHandler("flushForReinit",(t=>{this.reinitTelemetryTransport(t,e)})),e.registerMessageHandler("newLogger",(e=>{this.telemetryTransport?.createNewLogger(e.key,e.value),this.firstPartyLoggers[e.key]=e.value})),e.registerMessageHandler("logEvent",(e=>{this.telemetryTransport?.logEvent(e.key,e.value,e.userContextId)})),e.registerMessageHandler("newSecondPartyOneDsLogger",(e=>{this.createSecondPartyLogger(e.key,e.value.ingestionToken,e.value.useTeamsContext)})),e.registerMessageHandler("setupChannelMessengerPort",(e=>{this.registerMessageChannelPort(e.port,e.identifier)})),e.registerMessageHandler("teardownChannelMessengerPort",(e=>{delete this.liteExperienceChannels[e.identifier]})),e.registerMessageHandler("setPrimaryUser",(e=>{this.contextManager.setPrimaryUser(e.userContextId)})),e.registerMessageHandler("logSecondPartyEvent",(e=>{this.telemetryTransport?.logSecondPartyEvent(e.key,e.value)})),e.registerMessageHandler("logSession",(t=>{this.telemetryTransport?.logSession(e,t)})),e.registerMessageHandler("setUserId",(e=>{this.contextManager.setUserId(e)})),e.registerMessageHandler("setDeviceAuthToken",(e=>{this.telemetryTransport?.setDeviceAuthToken(e)})),e.registerMessageHandler("setContext",(e=>{this.contextManager.setContext(e,this.telemetryTransport)})),e.registerMessageHandler("setPrivacyGuardUserInfo",(e=>{this.enableOneDsSdk&&this.telemetryTransport?.setPrivacyGuardSensitiveInformation(e)})),e.registerMessageHandler("updateSDKWithPrivacyGuard",(e=>{this.enableOneDsSdk&&this.telemetryTransport?.updateSDKWithPrivacyGuard(e)})),e.registerMessageHandler("updateSDKWithLogSanitizer",(e=>{this.enableOneDsSdk&&this.telemetryTransport?.updateSDKWithLogSanitizer(e.flag,e.logSanitizerConfig)})),e.registerMessageHandler("updateSDKWithOfflineTelemetry",(e=>{this.enableOneDsSdk&&this.telemetryTransport?.updateSDKWithOfflineTelemetry(e)})),e.registerMessageHandler("logOutUser",(e=>{this.contextManager?.logOutUser(e)})),e.registerMessageHandler("setOnlineState",(async e=>{this.telemetryTransport?.setOnlineState(e)})),e.registerMessageHandler("startPerformanceObserver",(async()=>{this.performanceObserver||(this.performanceObserver=new PerformanceObserver(this.performanceObserverCallback),this.performanceObserver.observe({type:"resource"}))})),e.registerMessageHandler("stopPerformanceObserver",(async()=>{this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=void 0)}))}createSecondPartyLogger(e,t,s){this.secondPartyLoggers[e]={token:t,useTeamsContext:s},this.telemetryTransport?.createNewSecondPartyLogger(e,t,s)}reinitTelemetryTransport(e,t){this.telemetryTransport?.flushForReinit(t);const s=e.oneDsCollectorUrl||"",r=this.existingTransports[s];r?r.statusParams.active?this.telemetryTransport=r:(this.telemetryTransport=r,Object.keys(this.firstPartyLoggers).forEach((e=>{this.telemetryTransport?.statusParams.firstPartyLoggerTokens[e]&&this.telemetryTransport?.statusParams.firstPartyLoggerTokens[e]===this.firstPartyLoggers[e]||this.telemetryTransport?.createNewLogger(x.MP[e],this.firstPartyLoggers[e])})),Object.keys(this.secondPartyLoggers).forEach((e=>{this.telemetryTransport?.statusParams.secondPartyLoggerTokens[e]&&this.telemetryTransport?.statusParams.secondPartyLoggerTokens[e]===this.secondPartyLoggers[e].token||this.telemetryTransport?.createNewSecondPartyLogger(e,this.secondPartyLoggers[e].token,this.secondPartyLoggers[e].useTeamsContext)})),this.telemetryTransport.start()):(this.initTelemetryTransport(e),this.telemetryTransport?.createNewLogger(e.defaultLoggerName||x.MP.default,e.appTokens.default),this.telemetryTransport?.logSession(t,{name:e.defaultLoggerName||x.MP.default,state:b.Yj.STARTED,sessionId:e.sessionId,sessionStartTime:e.sessionStartTime}),Object.keys(this.firstPartyLoggers).forEach((e=>{this.telemetryTransport?.createNewLogger(x.MP[e],this.firstPartyLoggers[e])})),Object.keys(this.secondPartyLoggers).forEach((e=>{this.telemetryTransport?.createNewSecondPartyLogger(e,this.secondPartyLoggers[e].token,this.secondPartyLoggers[e].useTeamsContext)})))}initTelemetryTransport(e){this.contextManager.setEnableMTMA(!!e.enableMTMA),this.contextManager.setEnableMergedExpIds(!!e.enableMergedExpIds),e.enableDebugTrace?e.config.log=this:e.config.log=void 0,this.enableOneDsSdk=!0,this.telemetryTransport=new A(this.contextManager),this.existingTransports[e.oneDsCollectorUrl||"defaultOneDsUrl"]=this.telemetryTransport,this.telemetryTransport.initialize(e),this.delayedTransportCallbacks.length>0&&(this.delayedTransportCallbacks.forEach((e=>{e()})),this.delayedTransportCallbacks=[]),Object.keys(this.liteExperienceChannels).forEach((e=>this.liteExperienceChannels[e].postMessage("workerInitialized")))}}},670926:(e,t,s)=>{s.d(t,{k:()=>r});class r{constructor(){this.messageHandlers={},this.registerMessageHandler("batch",(e=>{for(const t of e)if(t&&t.name){const e=this.messageHandlers[t.name];e&&e(t.params)}this.postMessage("batchDone")}))}registerMessageHandler(e,t){this.messageHandlers[e]?console.warn(`message handler already registered for - ${e}`):this.messageHandlers[e]=t}unregisterMessageHandler(e){delete this.messageHandlers[e]}}},812178:(e,t,s)=>{s.d(t,{T:()=>r});class r{constructor(){this._buffer=[]}Add(e,t){-1==this._getIndex(e)&&this._buffer.push({Key:e,Value:t})}AddOrReplace(e,t){var s=this._getIndex(e);s>=0?this._buffer[s]={Key:e,Value:t}:this._buffer.push({Key:e,Value:t})}Remove(e){var t=this._getIndex(e);t>=0&&this._buffer.splice(t,1)}Count(){return this._buffer.length}GetBuffer(){return this._buffer}ContainsKey(e){return this._getIndex(e)>=0}Get(e){var t=this._getIndex(e);return t>=0?this._buffer[t].Value:null}_getIndex(e){for(var t=0,s=-1;t<this._buffer.length;++t)if(this._buffer[t].Key==e){s=t;break}return s}}},828735:(e,t,s)=>{s.d(t,{go:()=>v,zC:()=>T});var r=s(442424);class n{static IsSafariOrFirefox(){return null===n._isSafariOrFirefox&&n._DetectBrowser(),n._isSafariOrFirefox}static ajax(e){var t=n._createConnection();if(e.headers){var s="qsp=true";for(var r in e.headers)s+="&",s+=encodeURIComponent(r),s+="=",s+=encodeURIComponent(e.headers[r]);e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+=s}t.open(e.type,e.url),e.complete&&(t.onload=()=>{void 0===t.status&&(t.status=200),e.complete(t)},t.ontimeout=()=>{void 0===t.status&&(t.status=500),e.complete(t)},t.onerror=()=>{e.complete(t)}),t.send(e.data)}static keys(e){if(Object.keys)return Object.keys(e);var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(s);return t}static IsUsingXDomainRequest(){null==n._usingXDomainRequest&&(void 0===(new XMLHttpRequest).withCredentials&&"undefined"!=typeof XDomainRequest?n._usingXDomainRequest=!0:n._usingXDomainRequest=!1);return n._usingXDomainRequest}static _createConnection(){var e=new XMLHttpRequest;return n.IsUsingXDomainRequest()?new XDomainRequest:e}static _DetectBrowser(){var e=navigator.userAgent.toLowerCase();(e.indexOf("safari")>=0||e.indexOf("firefox")>=0)&&e.indexOf("chrome")<0?n._isSafariOrFirefox=!0:n._isSafariOrFirefox=!1}}n._isSafariOrFirefox=null,n._usingXDomainRequest=null;var i,a,o,l,h,g,d=s(93314),c=s(692753);class u{constructor(){this._buffer=[]}WriteByte(e){this._buffer.push(c.wN.ToByte(e))}Write(e,t,s){for(;s--;)this.WriteByte(e[t++])}GetBuffer(){return this._buffer}}class p{constructor(){this.data=[]}WriteBlob(e){let t={type:"blob",value:e};this.data.push(t)}WriteBool(e){let t={type:"boolean",value:e};this.data.push(t)}WriteContainerBegin(e,t){let s={type:"containerBegin",size:e,elementType:t};this.data.push(s)}WriteMapContainerBegin(e,t,s){let r={type:"mapContainerBegin",size:e,keyType:t,valueType:s};this.data.push(r)}WriteContainerEnd(){this.data.push({type:"containerEnd"})}WriteDouble(e){let t={type:"number",value:e};this.data.push(t)}WriteFloat(e){let t={type:"number",value:e};this.data.push(t)}WriteFieldBegin(e,t,s){let r={type:"fieldBegin",id:t};this.data.push(r)}WriteFieldEnd(){this.data.push({type:"fieldEnd"})}WriteFieldOmitted(e,t,s){let r={type:"fieldOmitted",id:t};this.data.push(r)}WriteInt16(e){let t={type:"number",value:e};this.data.push(t)}WriteInt32(e){let t={type:"number",value:e};this.data.push(t)}WriteInt64(e){let t={type:"number",value:4294967296*e.high+e.low};this.data.push(t)}WriteInt8(e){let t={type:"number",value:e};this.data.push(t)}WriteString(e){let t={type:"string",value:e};this.data.push(t)}WriteStructBegin(e,t){let s={type:"structBegin",isBase:t};this.data.push(s)}WriteStructEnd(e){let t={type:"structEnd",isBase:e};this.data.push(t)}WriteUInt16(e){let t={type:"number",value:e};this.data.push(t)}WriteUInt32(e){let t={type:"number",value:e};this.data.push(t)}WriteUInt64(e){let t={type:"number",value:e};this.data.push(t)}WriteUInt8(e){let t={type:"number",value:e};this.data.push(t)}WriteWString(e){let t={type:"string",value:e};this.data.push(t)}}!function(e){e[e.ECS_ERROR_OK=0]="ECS_ERROR_OK",e[e.ECS_ERROR_INVALID_STATUS=1]="ECS_ERROR_INVALID_STATUS",e[e.ECS_ERROR_INVALID_RESPONSE=6]="ECS_ERROR_INVALID_RESPONSE",e[e.ECS_ERROR_INVALID_CONFIG=8]="ECS_ERROR_INVALID_CONFIG"}(i||(i={}));!function(e){e[e.CONFIG_UPDATED=0]="CONFIG_UPDATED",e[e.TOKEN_IS_INVALID=1]="TOKEN_IS_INVALID"}(a||(a={}));class _{}_.Servers=["https://config.teams.microsoft.com/config/v1/Skype/"],_.RefreshIntervalInMS=36e5,_.FailedRetryFactorInMS=1e4,_.MaxRetryIntervalForFailedInMS=36e5,function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started",e[e.Loading=3]="Loading"}(o||(o={}));class m{static get version(){return"2.5.0"}}!function(e){e[e.SENT=0]="SENT",e[e.SEND_FAILED=1]="SEND_FAILED"}(l||(l={})),function(e){e[e.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",e[e.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",e[e.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",e[e.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",e[e.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",e[e.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"}(h||(h={}));class f{constructor(e){this._errorCode=h.DATARV_ERROR_OK,this._errorCode=e}ErrorCode(){return this._errorCode}toString(){switch(this._errorCode){case h.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case h.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case h.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case h.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case h.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case h.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}}}class v{constructor(){this.eventsLimitInMem=1e4}}class T{static CreateTelemetryManager(){return new E}}class I{}I.MaxPackageSizeInBytes=3e6,I.TimeIntervalForNextSendInMS=15e3,function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started"}(g||(g={}));class E{constructor(){this._MaxPackageSizeInBytes=I.MaxPackageSizeInBytes,this._listeners=[],this._status=g.Created,this._ecsClient=null,this._etag=null,this._ecsCallback=null,this._testServerResponseHook=null,this._testHookListeners=[]}Initialize(e){if(this._status!=g.Created)throw new f(h.DATARV_ERROR_INVALID_STATUS);if(!e||!e.collectorUrl)throw new f(h.DATARV_ERROR_INVALID_CONFIG);this._config=e,this._Reset(),this._status=g.Initialized,e.ecsClient&&(this._Verbose("ECS object assigned. Do integration"),this._ecsClient=e.ecsClient),e.overwriteSendTimeInterval&&e.overwriteSendTimeInterval>=0&&(I.TimeIntervalForNextSendInMS=e.overwriteSendTimeInterval),this._Verbose("Initialize() done")}setEventsLimitInMem(e){this._eventsCache.setEventsLimitInMem(e)}AddListener(e){if(this._status<g.Initialized)throw new f(h.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return void this._Verbose("the listener has been added already, index: "+t);this._listeners.push(e),this._Verbose("AddListener() done, the new length: "+this._listeners.length)}RemoveListener(e){if(this._status<g.Initialized)throw new f(h.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return 1==this._listeners.length?this._listeners=[]:t==this._listeners.length-1?this._listeners.pop():this._listeners[t]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",t,"new length: ",this._listeners.length].join(""));this._Verbose("listener isn't been found, new length"+this._listeners.length)}Start(){if(this._status<g.Initialized)throw new f(h.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",E._tag].join(" ")),this._status>=g.Started&&this._Verbose("Start() already, ignore"),this._ecsClient&&(this._ecsCallback=this._CreateEcsCallback(),this._ecsClient.AddListener(this._ecsCallback),this._etag=this._ecsClient.GetETag()),++E._tag,this._status=g.Started,this._Verbose(["Start() done, status: ",this._status,"tag: ",E._tag].join(""))}Stop(){if(this._status<g.Initialized)throw new f(h.DATARV_ERROR_INVALID_STATUS);this._Verbose("Stop(), status: "+this._status),this._status!=g.Initialized?(this._Reset(),this._status=g.Initialized,this._Verbose("Stop() done, status: "+this._status)):this._Verbose("Stop() already, ignore")}Flush(e){this._eventsCache.IsEmpty()||this._WorkThread(e)}SendAsync(e,t){if(this._status<g.Initialized)throw new f(h.DATARV_ERROR_INVALID_STATUS);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",e,"count:",t.length].join(" ")),this._status<g.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!e||!t)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new f(h.DATARV_ERROR_INVALID_ARG);for(var s=0;s<t.length;++s)if(!t[s].Id||!E._eventTypeRegex.test(t[s].EventType)||t[s].Timestamp.Equals("0"))throw this._Error(["eventId:",t[s].Id,"eventType:",t[s].EventType,"timestamp high:",t[s].Timestamp.high,"timestamp low:",t[s].Timestamp.low].join("")),new f(h.DATARV_ERROR_INVALID_EVENT);return this._eventsCache?.AddEvents(e,t),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0}_WorkThread(e){try{var t=Date.now();if(this._Verbose("_WorkThread, status: "+this._status),this._status<g.Started)return void this._Verbose("_WorkThread, status is not started, return");var s=this._eventsCache.DequeuEvents();if(null==s)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();var r=s.events.length,i=this._PackEvents(s.tenantToken,s.events);this._eventsCache?.AddEvents(s.tenantToken,i.remainedEvents);var a=i.remainedEvents.length;if(null==i.buffer||0==i.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testHookListeners)for(var o=0;o<this._testHookListeners.length;++o)this._testHookListeners[o](i.sendEvents);if(this._testServerResponseHook){var l=this._testServerResponseHook();return void setTimeout((()=>this._SendCallback(c,s.tenantToken,i.sendEvents,l,null)),100)}var h={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+m.version},complete:t=>this._SendCallback(c,s.tenantToken,i.sendEvents,t,e)};this._config.useJsonTextStream?(h.data=i.buffer,h.headers["content-type"]="application/json"):n.IsSafariOrFirefox()||"undefined"==typeof Uint8Array?(this._Verbose("Uint8Array is undefined, send with base64 encode."),h.data=d.o4.GetString(i.buffer),h.headers["content-encoding"]="base64"):(this._Verbose("Uint8Array is defined, send with binary format directly."),h.data=new Uint8Array(i.buffer)),s.tenantToken&&(h.headers["x-apikey"]=s.tenantToken);var c=E._tag;this._lastActiveTime=(new Date).getTime(),n.ajax(h),this._Verbose("_Workthread, send via jquery, tag: "+c),this._Info("Processing telemetry events took "+(Date.now()-t)+" ms for "+(r-a)+" events with total size of "+i.buffer.length+" bytes, remaining events - "+a)}catch(e){this._Error("_WorkThread, exception: "+e)}}_PackEvents(e,t){this._Verbose("_PackageEvents, total Count: "+t.length);var s,n=new r.D2,i=new r.LY;i.Source="JS_default_source",i.DataPackageId=r.Wp.GetGuid(),i.Timestamp=r.Wp.GetTimeStamp();var a=t;if(t=[],a.length>200){var o=a.splice(0,200);t.push.apply(t,a),a=o}for(;i.Records=[],i.Records.push.apply(i.Records,a),n.DataPackages=[],n.DataPackages.push(i),s=this._Serialize(n),this._Verbose(["_PackageEvents, sendEvents.length:",a.length," buffer.length:",s.length," MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),!(s.length<this._MaxPackageSizeInBytes);){if(1==a.length){a=[],s=null;break}var l=a.splice(0,Math.floor(a.length/2));this._Verbose("_PackageEvents, too large, package again"),t.push.apply(t,a),a=l}return this._Verbose(["_PakcageEvents done, sendEventsCount:",a.length,"buffer.length:",null==s?0:s.length,"remained events:",t.length].join("")),{buffer:s,sendEvents:a,remainedEvents:t}}_Serialize(e){if(this._config.useJsonTextStream){var t=new p;return e.Write(t),JSON.stringify(t.data)}var s=new u,r=new c.E1(s);return e.Write(r),s.GetBuffer()}_SendCallback(e,t,s,r,n){if(this._Verbose(["_SendCallback","tag:",e,"current tag:",E._tag,"tenantToken:",t,"events count:",s.length,"jqXHR:",r].join("")),null==n){var i=null!=r&&r.status>=200&&r.status<300;if(this._status<g.Started||e<E._tag)this._Verbose("_SendCallback, is not started, or tag is not the same, return");else{if(!(i||r&&400==r.status))return this._Verbose("retry statusCode: "+(r?r.status:0)),this._eventsCache?.AddEvents(t,s),void this._ScheduleTimer(!0);for(var a=0;a<this._listeners.length;++a)this._listeners[a](i?l.SENT:l.SEND_FAILED,r?r.status:0,t,s);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))}}else n(r?r.status:0,t,s)}_CleanTimer(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)}_ScheduleTimer(e){if(this._Verbose("_ScheduleTimer: isRetry: "+e),this._CleanTimer(),e){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);t=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout((()=>this._WorkThread(null)),1e3*t),this._Verbose("_ScheduleTimer, next try (s): "+t),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}else{var t=0,s=(new Date).getTime()-this._lastActiveTime;t=s>I.TimeIntervalForNextSendInMS?0:I.TimeIntervalForNextSendInMS-s,this._timer=setTimeout((()=>this._WorkThread(null)),t),this._Verbose("_ScheduleTimer, next try: "+t),this._rescheduleFactor=1}}_Verbose(e){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+e)}_Info(e){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+e)}_Error(e){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+e)}_Reset(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new y(this._config.log,this._config.eventsLimitInMem),this._ecsClient&&(this._ecsClient.RemoveListener(this._ecsCallback),this._ecsCallback=null)}_CreateEcsCallback(){return e=>{e==a.CONFIG_UPDATED&&(this._etag=this._ecsClient.GetETag())}}__AddTestHookListener(e){if(this._status<g.Initialized)throw new f(h.DATARV_ERROR_INVALID_STATUS);for(var t=0;t<this._testHookListeners.length;++t)if(this._testHookListeners[t]==e)return;this._testHookListeners.push(e)}__ClearTestHookListener(){this._testHookListeners=[]}__GetListenerArray(){return this._listeners}__GetTotalEventsCount(){return this._eventsCache.GetTotalEventsCount()}__IsScheduled(){return null!=this._timer}__ChageMaxPackageSizeInKB(e){this._MaxPackageSizeInBytes=1024*e}__SetTestServerResponseHook(e){this._testServerResponseHook=e}}E._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,E._tag=0;class y{constructor(e,t){this._logger=e,this._eventsLimitInMem=t,this._events={},this._tokens=[]}AddEvents(e,t){t.length&&(t.length>this._eventsLimitInMem?this._logDroppedEvents(e,t.length):(this._events[e]||(this._events[e]=[],this._tokens.push(e)),this._events[e].push.apply(this._events[e],t)))}IsEmpty(){return 0==this._tokens.length}DequeuEvents(){if(0==this._tokens.length)return null;var e=this._tokens.shift(),t=this._events[e];return delete this._events[e],{tenantToken:e,events:t}}GetTotalEventsCount(){var e=0;for(var t in this._events)e+=this._events[t].length;return e}setEventsLimitInMem(e){this._eventsLimitInMem=e}_logDroppedEvents(e,t){if(!this._logger)return;let s=0;this._events[e]&&(s=this._events[e].length),this._logger.Verbose(`[TelemetryEventCache]: Size of dropped events: ${t},\n      events size currently in queue for tenant ${e}: ${s}`)}}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/19297-9aaef3b45904b8bc.js.map